# TheSydeKick-System Development Kit
Initiated by Marko Kosunen, marko.kosunen@aalto.fi 7.8.2017

OBS: THE SCRIPTS TO BE SOURCED ARE WRITTEN FOR T-SHELL
if you're using some other shell, change to tcsh or modify the scripts to be 
compliant with your shell.
~>tcsh

## CONFIGURATION Quickstart
Go to TheSDK directory and run 
~>./init_submodules
~>./configure

-Edit the TheSDK.config file so that the commands for python 
invocations are correct. 
Variables in TheSDK.config
--CONTROLLER [MATLAB|PYTHON] defines which of these you want to use for main
  simulation environment.

  Rest of the variables defines the commands used in Makefiles for simulation
  submission main thing to decide here is if you have LSF compliant cluster
  environment or not. Modify commands accordingly.


-Configure latex, and simulators ( vsim, eldo, spectre etc.) tools to your path, 
modify sourceme.csh if needed and source it
~>source sourceme.csh

-If you are using python, you may need to install some modules locally.
run ./pip3userinstall.sh or modify it to be compliant with your current python
version.
~>./pip3userinstall.sh


-To test your environment
cd Simulations/Inverter 
For Python:
~>./configure && make clean && make all
(Dependency tracking for Python currently not functional)

'make all' by default uses LSF submission. If that for some reason does not work, try
~>./configure && make clean && make pyl && make slides

If you wish to test the Python functionality only, edit Simulations/Inverter/configure
antd Change the line
PYTHONMODELS="[ 'py', 'vhdl', 'sv' ]"
to
PYTHONMODELS="[ 'py', 'py', 'py' ]"
and run 
./configure && make clean && make pyl && make slides


For Matlab:
~>./configure -C && make all

Check the results in ./Slides/pdffiles/Inverter.pdf

-----
TO CREATE AND TEST NEW SIMULATIONS

Create a simulation for the chain of inverters:
cd ./Simulations
./Simtemplate/initsim <NAME>

Check the results
cd <NAME> && ./configure && make all
Check the results in ./Slides/pdffiles/<Name>.pdf


HOW TO USE TheSDK

TheSDK is a multi-tool simulation and developement environment for developing systems. 
It targets to using a single control environment to simulate,design and measure the 
system components with various tools by using a single "Control environment" for
control, analysis, and visualization of the resutls.

Implementation the "Control environment" is written in Object-oriented
Matlab and Python, but any high level versatile general programming language
supporting object oriented programming will do. Python/Matlab is selected based on
its good support for computing and signal processing, and support for
interfaces to measurement equipment. State of maturity between Python and Matlab may
different. 

NAMING AND STRUCTURE
The files are organized in directories as follows
                      TheSDK
configure
TheSDK.config (generated by configure)
Entities                                Simulations
    |                                       |
    entity1                                 Sim1
        @entity1                                |
             |                                  configure
             entity1.m                          Makefile (generated by configure)
        entity1                                 Slides
             |                                      |
             __init__.py                            makearticle 
             other_module.py                        Sim1.tex     
        vhd                                         pdffiles     
            |                                           |        
            entity1.vhd                                 Sim1.pdf
            tb_entity1.vhd                                     
        sv                                                
            |                                   
            entity1.sv                          
            tb_entity1.sv
        Simulations
            rtlsim
                |
                work

Guidelines to follow (Examples for Matlab but apply to Python too)
--All simulations configured, performed and results processed under Simulations directory
--All component descriptions, called Entities, regardless of the used tool/language are 
  located under Entities directory.


CLASS ORGANIZATION
The Entities and simulation setups are implemented as classes that  
cross-reference to each other without restrictions. In order to simplify this, 
    -Packages are not currently used as they would require package definitions
    in function calls everywhere.


EXAMPLE of class dependencies and relations
        
           
"@system_abstract_class" << @thesdk << @verilog,@vhdl
          \                 /          /
           \               /          /
             "@system_sim"           /
                    |               /
                "@system"          /
                    /\            /
       "@entity1"  "@entity2"
            |
      "@entity3"


--@thesdk is a class to collect methods common to "TheSDK"-framework, NOT
system_sim, system or entities. It should NOT contain anything specific to
a particular system. 
It should be superclass to all classes in TheSDK, except verilog and vhdl, which 
which are currently independent.   

--@verilog abstract class defines properties and methods that are required to 
run verilog simulations.

If component does not have @verilog as a superclass, verilog-requirements do not 
apply. This is used to provide concise structure for verilog component models. 
Consequently, if component has an  model, it MUST  be a a subclass of @verilog. 
(Note: It is be best to define the tools used for RTL 
simulations in @rtl, but currently they are defined within component for syntax clarity)

--"@system_abstract_class" may used as super class for the "@system_sim" and
    "@system" to define the properties that typically 
        1) Are common to whole systems. 
        2) Need not to be altered between simulations, but are most often
        propagated through property inheritance.

Typically a simulation is controlled by "@system_sim" class that controls 
the simulation providing methods like  "run" and  "plot".
(see Entities/inv_sim/@inv_sim/inv_sim.)

--Component properties are controlled and propagated by class constructor by copying the
    selected properties from immediate "parent". The properties that are to be copied are determined 
    by property "proplist".

COMPONENT HIERARCHY GUIDELINE
--Take FIRST a look at 
    Entities/inv_sim/@inv_sim/inv_sim.m 
    and
    Entities/inv/@inv/inv.m

--System is described in "system" class that determines the 
    sub-components and the interconnections in between them, and methods to 
    "run" the "system", i.e. how the signals propagate and in which order 
    the methods of components are executed.

--If the system is simple, "sim" class may also construct the system. 
    (see Entities/inv_sim/@inv_sim/inv_sim.)

Guidelines to be followed:
--- In general, a set of features related to certain mode of operation should be enforced with
    a abstract class whose usage is optional for an entity, like @verilog.

--Components are not subclasses to sim or system class as they should be
    independent of each other and transferrable between systems. 

---sim class is not a superclass to system class, as the "system" definitions 
    independent of how it is simulated.

SIGNAL PROPAGATION GUIDELINES
--Variables that present "signals" transfered from one class to another should
be
    1) Defined as class property in component class with private set access in 
       a component that generates the value for that property, "The Driver"
    2) Assigned with a refptr class _in parent_ to the property with public set access of
       a another component "The Load".
    3) To distinguish these "input properties", their names should start with
       string "iptr_"
    4) refptr class method should not be used to _inside_ a component class to refer 
       output properties of other components at the same level of hierarchy.

Refptr should be considered as a signal between components. Use of pointers is
justified to save memory, and to enable the definition of  connections between
the components at the sytem initiation phase.

WHAT NEXT?:
Take yout time to get acquainted with Entities/inverter and Entities/inv_sim
together with Entities/thesdk and Entities/verilog that should give you a picture how the things work.

Then read Simulation/Inverter/configure, and try to understand what happens there.
